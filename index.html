<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrganizadorFiestas - 50 Aniversario (Cloud)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
        
        // Configuraci√≥n de Firebase (reemplaza con tu configuraci√≥n)
        const firebaseConfig = {
            apiKey: "AIzaSyDZNbANkDPao0nucej2kW2u3VtltfGoYck",
            authDomain: "organizadorfiestas-b7190.firebaseapp.com",
            projectId: "organizadorfiestas-b7190",
            storageBucket: "organizadorfiestas-b7190.firebasestorage.app",
            messagingSenderId: "390736807585",
            appId: "1:390736807585:web:0bcfc21202acc8cc7e92e0",
            measurementId: "G-ZCNPZPETW9"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Hacer disponible globalmente
        window.firebaseDB = db;
        window.firebaseFunctions = {
            collection,
            addDoc,
            getDocs,
            doc,
            updateDoc,
            deleteDoc,
            query,
            orderBy
        };
        
        // Inicializar la aplicaci√≥n cuando Firebase est√© listo
        window.addEventListener('load', function() {
            initApp();
        });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            text-align: center;
            padding: 30px;
            position: relative;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .db-status {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .db-connected {
            background: rgba(46, 213, 115, 0.3);
        }
        
        .db-error {
            background: rgba(255, 71, 87, 0.3);
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #19547b;
            border-bottom-color: #19547b;
        }
        
        .tab-content {
            padding: 30px;
            min-height: 600px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #19547b 0%, #ffd89b 100%);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #19547b;
            box-shadow: 0 0 0 2px rgba(25, 84, 123, 0.2);
        }
        
        .currency {
            text-align: right;
            font-weight: 500;
        }
        
        .pending {
            background: #fee;
            color: #c53030;
            font-weight: bold;
        }
        
        .btn {
            background: linear-gradient(135deg, #19547b 0%, #ffd89b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 10px 5px;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #c44569 100%);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            min-width: 60px;
        }
        
        .add-row {
            margin: 20px 0;
            text-align: center;
        }
        
        .instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .cloud-info {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #19547b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .action-buttons {
            display: inline-flex;
            gap: 5px;
            white-space: nowrap;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .tab {
                min-width: 120px;
                font-size: 14px;
                padding: 12px 15px;
            }
            
            table {
                font-size: 12px;
                min-width: 800px;
            }
            
            .tab-content {
                overflow-x: auto;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="db-status" id="dbStatus">
                <span class="loading"></span> Conectando a la nube...
            </div>
            <button onclick="mostrarInfoCloud()" style="position: absolute; top: 15px; left: 20px; background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(10px);">
                ‚òÅÔ∏è Info
            </button>
            <h1>üéâ Organizador de Fiesta</h1>
            <p>50 Aniversario de Bodas - Versi√≥n Cloud</p>
        </div>
        
        <div class="cloud-info">
            <strong>‚òÅÔ∏è Base de Datos en la Nube</strong><br>
            Tus datos se sincronizan autom√°ticamente entre todos tus dispositivos y navegadores.
            Accede desde cualquier lugar y mant√©n todo actualizado en tiempo real.
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('aportes')">üí∞ Aportes de la Familia</button>
            <button class="tab" onclick="showTab('gastos')">üí∏ Gastos de la Fiesta</button>
            <button class="tab" onclick="showTab('tareas')">üìù Tareas</button>
            <button class="tab" onclick="showTab('invitados')">üë• Invitados</button>
            <button class="tab" onclick="showTab('resumen')">üìä Resumen General</button>
        </div>
        
        <div class="tab-content">
            <!-- HOJA 1: APORTES DE LA FAMILIA -->
            <div id="aportes" class="tab-pane active">
                <div class="instructions">
                    <strong>üí° Instrucciones:</strong> Registra los aportes de cada familiar. Los datos se guardan autom√°ticamente en la nube y se sincronizan entre todos tus dispositivos en tiempo real.
                </div>
                
                <table id="tablaAportes">
                    <thead>
                        <tr>
                            <th>Nombre del Integrante</th>
                            <th>Monto Comprometido</th>
                            <th>Monto Entregado</th>
                            <th>Fecha de Aporte</th>
                            <th>Forma de Pago</th>
                            <th>Observaciones</th>
                            <th>Saldo Pendiente</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos se cargar√°n desde Firebase -->
                    </tbody>
                </table>
                
                <div class="add-row">
                    <button class="btn" onclick="agregarNuevoAporte()">‚ûï Agregar Familiar</button>
                </div>
            </div>
            
            <!-- HOJA 2: GASTOS DE LA FIESTA -->
            <div id="gastos" class="tab-pane">
                <div class="instructions">
                    <strong>üí° Instrucciones:</strong> Registra todos los gastos de la fiesta por categor√≠as. Los datos se almacenan autom√°ticamente en la nube.
                </div>
                
                <table id="tablaGastos">
                    <thead>
                        <tr>
                            <th>Categor√≠a</th>
                            <th>Proveedor</th>
                            <th>Costo Estimado</th>
                            <th>Costo Real</th>
                            <th>Diferencia</th>
                            <th>Fecha de Pago</th>
                            <th>Pagado Por</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos se cargar√°n desde Firebase -->
                    </tbody>
                </table>
                
                <div class="add-row">
                    <button class="btn" onclick="agregarNuevoGasto()">‚ûï Agregar Gasto</button>
                </div>
            </div>
            
            <!-- HOJA 3: TAREAS -->
            <div id="tareas" class="tab-pane">
                <div class="instructions">
                    <strong>üí° Instrucciones:</strong> Organiza todas las tareas necesarias para la fiesta. Sincronizaci√≥n autom√°tica en tiempo real.
                </div>
                
                <table id="tablaTareas">
                    <thead>
                        <tr>
                            <th>Tarea</th>
                            <th>Categor√≠a</th>
                            <th>Responsable</th>
                            <th>Fecha L√≠mite</th>
                            <th>Prioridad</th>
                            <th>Estado</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos se cargar√°n desde Firebase -->
                    </tbody>
                </table>
                
                <div class="add-row">
                    <button class="btn" onclick="agregarNuevaTarea()">‚ûï Agregar Tarea</button>
                </div>
            </div>
            
            <!-- HOJA 4: INVITADOS -->
            <div id="invitados" class="tab-pane">
                <div class="instructions">
                    <strong>üí° Instrucciones:</strong> Gestiona la lista de invitados con sincronizaci√≥n autom√°tica en todos tus dispositivos.
                </div>
                
                <table id="tablaInvitados">
                    <thead>
                        <tr>
                            <th>Nombre Completo</th>
                            <th>Relaci√≥n</th>
                            <th>Tel√©fono</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Acompa√±antes</th>
                            <th>Necesidades Especiales</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos se cargar√°n desde Firebase -->
                    </tbody>
                </table>
                
                <div class="add-row">
                    <button class="btn" onclick="agregarNuevoInvitado()">‚ûï Agregar Invitado</button>
                </div>
            </div>
            
            <!-- HOJA 5: RESUMEN GENERAL -->
            <div id="resumen" class="tab-pane">
                <div class="instructions">
                    <strong>üìä Resumen financiero actualizado en tiempo real desde la nube.</strong>
                </div>
                
                <div id="resumenContent">
                    <!-- Se cargar√° din√°micamente -->
                </div>
            </div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #f8f9fa; margin: 20px 0; border-radius: 8px;">
            <h3>üìä Exportar Datos</h3>
            <p>Descarga tus datos en formato Excel</p>
            <button class="btn" onclick="exportarExcel()">üìä Descargar Excel</button>
        </div>
    </div>

    <script>
        let aportes = [];
        let gastos = [];
        let tareas = [];
        let invitados = [];
        
        // Inicializar la aplicaci√≥n
        async function initApp() {
            try {
                updateDBStatus('üü¢ Conectado a la nube', 'db-connected');
                await cargarDatos();
            } catch (error) {
                console.error('Error inicializando:', error);
                updateDBStatus('‚ùå Error de conexi√≥n', 'db-error');
                mostrarModoOffline();
            }
        }
        
        function updateDBStatus(text, className) {
            const statusEl = document.getElementById('dbStatus');
            statusEl.innerHTML = text;
            statusEl.className = `db-status ${className}`;
        }
        
        function mostrarModoOffline() {
            alert('‚ö†Ô∏è No se pudo conectar a la base de datos en la nube.\n\nPor favor:\n1. Verifica tu conexi√≥n a internet\n2. Configura Firebase correctamente\n3. Actualiza la p√°gina');
        }
        
        function mostrarInfoCloud() {
            alert(`‚òÅÔ∏è BASE DE DATOS EN LA NUBE

‚úÖ VENTAJAS:
‚Ä¢ Acceso desde cualquier dispositivo
‚Ä¢ Sincronizaci√≥n autom√°tica en tiempo real
‚Ä¢ Sin p√©rdida de datos al cambiar navegador
‚Ä¢ Respaldos autom√°ticos en la nube
‚Ä¢ Colaboraci√≥n familiar en tiempo real

üîß CONFIGURACI√ìN REQUERIDA:
Para que funcione necesitas configurar Firebase:
1. Crear proyecto en Firebase
2. Habilitar Firestore
3. Configurar las credenciales en el c√≥digo

üì± UNA VEZ CONFIGURADO:
Podr√°s acceder desde cualquier lugar y dispositivo
con tus datos siempre sincronizados.`);
        }
        
        // Funciones para manejar datos
        async function cargarDatos() {
            if (!window.firebaseDB) {
                console.error('Firebase no est√° configurado');
                return;
            }
            
            try {
                // Cargar aportes
                const aportesSnapshot = await window.firebaseFunctions.getDocs(
                    window.firebaseFunctions.collection(window.firebaseDB, 'aportes')
                );
                aportes = aportesSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Cargar gastos
                const gastosSnapshot = await window.firebaseFunctions.getDocs(
                    window.firebaseFunctions.collection(window.firebaseDB, 'gastos')
                );
                gastos = gastosSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Cargar tareas
                const tareasSnapshot = await window.firebaseFunctions.getDocs(
                    window.firebaseFunctions.collection(window.firebaseDB, 'tareas')
                );
                tareas = tareasSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Cargar invitados
                const invitadosSnapshot = await window.firebaseFunctions.getDocs(
                    window.firebaseFunctions.collection(window.firebaseDB, 'invitados')
                );
                invitados = invitadosSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Actualizar todas las tablas
                actualizarTablaAportes();
                actualizarTablaGastos();
                actualizarTablaTareas();
                actualizarTablaInvitados();
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                updateDBStatus('‚ùå Error cargando datos', 'db-error');
            }
        }
        
        // Funciones para actualizar tablas
        function actualizarTablaAportes() {
            const tbody = document.querySelector('#tablaAportes tbody');
            tbody.innerHTML = '';
            
            aportes.forEach(aporte => {
                const saldo = (aporte.monto_comprometido || 0) - (aporte.monto_entregado || 0);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="text" value="${aporte.nombre || ''}" onchange="actualizarAporte('${aporte.id}', 'nombre', this.value)"></td>
                    <td><input type="number" step="0.01" value="${aporte.monto_comprometido || 0}" onchange="actualizarAporte('${aporte.id}', 'monto_comprometido', this.value)"></td>
                    <td><input type="number" step="0.01" value="${aporte.monto_entregado || 0}" onchange="actualizarAporte('${aporte.id}', 'monto_entregado', this.value)"></td>
                    <td><input type="date" value="${aporte.fecha_aporte || ''}" onchange="actualizarAporte('${aporte.id}', 'fecha_aporte', this.value)"></td>
                    <td>
                        <select onchange="actualizarAporte('${aporte.id}', 'forma_pago', this.value)">
                            <option value="">Seleccionar...</option>
                            <option value="efectivo" ${aporte.forma_pago === 'efectivo' ? 'selected' : ''}>Efectivo</option>
                            <option value="transferencia" ${aporte.forma_pago === 'transferencia' ? 'selected' : ''}>Transferencia</option>
                            <option value="tarjeta" ${aporte.forma_pago === 'tarjeta' ? 'selected' : ''}>Tarjeta</option>
                        </select>
                    </td>
                    <td><input type="text" value="${aporte.observaciones || ''}" onchange="actualizarAporte('${aporte.id}', 'observaciones', this.value)"></td>
                    <td class="currency ${saldo > 0 ? 'pending' : ''}">‚Ç°${saldo.toFixed(2)}</td>
                    <td class="action-buttons">
                        <button class="btn btn-danger btn-small" onclick="eliminarAporte('${aporte.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function actualizarTablaGastos() {
            const tbody = document.querySelector('#tablaGastos tbody');
            tbody.innerHTML = '';
            
            gastos.forEach(gasto => {
                const diferencia = (gasto.costo_estimado || 0) - (gasto.costo_real || 0);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <select onchange="actualizarGasto('${gasto.id}', 'categoria', this.value)">
                            <option value="">Seleccionar...</option>
                            <option value="banquete" ${gasto.categoria === 'banquete' ? 'selected' : ''}>üçΩÔ∏è Banquete</option>
                            <option value="musica" ${gasto.categoria === 'musica' ? 'selected' : ''}>üéµ M√∫sica</option>
                            <option value="decoracion" ${gasto.categoria === 'decoracion' ? 'selected' : ''}>üéÄ Decoraci√≥n</option>
                            <option value="fotografia" ${gasto.categoria === 'fotografia' ? 'selected' : ''}>üì∏ Fotograf√≠a</option>
                            <option value="otros" ${gasto.categoria === 'otros' ? 'selected' : ''}>üì¶ Otros</option>
                        </select>
                    </td>
                    <td><input type="text" value="${gasto.proveedor || ''}" onchange="actualizarGasto('${gasto.id}', 'proveedor', this.value)"></td>
                    <td><input type="number" step="0.01" value="${gasto.costo_estimado || 0}" onchange="actualizarGasto('${gasto.id}', 'costo_estimado', this.value)"></td>
                    <td><input type="number" step="0.01" value="${gasto.costo_real || 0}" onchange="actualizarGasto('${gasto.id}', 'costo_real', this.value)"></td>
                    <td class="currency">‚Ç°${diferencia.toFixed(2)}</td>
                    <td><input type="date" value="${gasto.fecha_pago || ''}" onchange="actualizarGasto('${gasto.id}', 'fecha_pago', this.value)"></td>
                    <td><input type="text" value="${gasto.pagado_por || ''}" onchange="actualizarGasto('${gasto.id}', 'pagado_por', this.value)"></td>
                    <td><input type="text" value="${gasto.observaciones || ''}" onchange="actualizarGasto('${gasto.id}', 'observaciones', this.value)"></td>
                    <td class="action-buttons">
                        <button class="btn btn-danger btn-small" onclick="eliminarGasto('${gasto.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function actualizarTablaTareas() {
            const tbody = document.querySelector('#tablaTareas tbody');
            tbody.innerHTML = '';
            
            tareas.forEach(tarea => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="text" value="${tarea.tarea || ''}" onchange="actualizarTarea('${tarea.id}', 'tarea', this.value)"></td>
                    <td>
                        <select onchange="actualizarTarea('${tarea.id}', 'categoria', this.value)">
                            <option value="">Seleccionar...</option>
                            <option value="planificacion" ${tarea.categoria === 'planificacion' ? 'selected' : ''}>üìã Planificaci√≥n</option>
                            <option value="decoracion" ${tarea.categoria === 'decoracion' ? 'selected' : ''}>üéÄ Decoraci√≥n</option>
                            <option value="comida" ${tarea.categoria === 'comida' ? 'selected' : ''}>üçΩÔ∏è Comida</option>
                            <option value="musica" ${tarea.categoria === 'musica' ? 'selected' : ''}>üéµ M√∫sica</option>
                            <option value="invitaciones" ${tarea.categoria === 'invitaciones' ? 'selected' : ''}>üíå Invitaciones</option>
                            <option value="logistica" ${tarea.categoria === 'logistica' ? 'selected' : ''}>üöõ Log√≠stica</option>
                            <option value="otros" ${tarea.categoria === 'otros' ? 'selected' : ''}>üì¶ Otros</option>
                        </select>
                    </td>
                    <td><input type="text" value="${tarea.responsable || ''}" onchange="actualizarTarea('${tarea.id}', 'responsable', this.value)"></td>
                    <td><input type="date" value="${tarea.fecha_limite || ''}" onchange="actualizarTarea('${tarea.id}', 'fecha_limite', this.value)"></td>
                    <td>
                        <select onchange="actualizarTarea('${tarea.id}', 'prioridad', this.value)">
                            <option value="baja" ${tarea.prioridad === 'baja' ? 'selected' : ''}>üü¢ Baja</option>
                            <option value="media" ${tarea.prioridad === 'media' ? 'selected' : ''}>üü° Media</option>
                            <option value="alta" ${tarea.prioridad === 'alta' ? 'selected' : ''}>üî¥ Alta</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="actualizarTarea('${tarea.id}', 'estado', this.value)">
                            <option value="pendiente" ${tarea.estado === 'pendiente' ? 'selected' : ''}>‚è≥ Pendiente</option>
                            <option value="en_progreso" ${tarea.estado === 'en_progreso' ? 'selected' : ''}>üöß En Progreso</option>
                            <option value="completada" ${tarea.estado === 'completada' ? 'selected' : ''}>‚úÖ Completada</option>
                        </select>
                    </td>
                    <td><input type="text" value="${tarea.observaciones || ''}" onchange="actualizarTarea('${tarea.id}', 'observaciones', this.value)"></td>
                    <td class="action-buttons">
                        <button class="btn btn-danger btn-small" onclick="eliminarTarea('${tarea.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function actualizarTablaInvitados() {
            const tbody = document.querySelector('#tablaInvitados tbody');
            tbody.innerHTML = '';
            
            invitados.forEach(invitado => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="text" value="${invitado.nombre_completo || ''}" onchange="actualizarInvitado('${invitado.id}', 'nombre_completo', this.value)"></td>
                    <td>
                        <select onchange="actualizarInvitado('${invitado.id}', 'relacion', this.value)">
                            <option value="">Seleccionar...</option>
                            <option value="familia" ${invitado.relacion === 'familia' ? 'selected' : ''}>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familia</option>
                            <option value="amigos" ${invitado.relacion === 'amigos' ? 'selected' : ''}>üë• Amigos</option>
                            <option value="trabajo" ${invitado.relacion === 'trabajo' ? 'selected' : ''}>üíº Trabajo</option>
                            <option value="vecinos" ${invitado.relacion === 'vecinos' ? 'selected' : ''}>üèòÔ∏è Vecinos</option>
                            <option value="otros" ${invitado.relacion === 'otros' ? 'selected' : ''}>üë§ Otros</option>
                        </select>
                    </td>
                    <td><input type="tel" value="${invitado.telefono || ''}" onchange="actualizarInvitado('${invitado.id}', 'telefono', this.value)"></td>
                    <td><input type="email" value="${invitado.email || ''}" onchange="actualizarInvitado('${invitado.id}', 'email', this.value)"></td>
                    <td>
                        <select onchange="actualizarInvitado('${invitado.id}', 'estado', this.value)">
                            <option value="pendiente" ${invitado.estado === 'pendiente' ? 'selected' : ''}>‚è≥ Pendiente</option>
                            <option value="confirmado" ${invitado.estado === 'confirmado' ? 'selected' : ''}>‚úÖ Confirmado</option>
                            <option value="no_asiste" ${invitado.estado === 'no_asiste' ? 'selected' : ''}>‚ùå No Asiste</option>
                        </select>
                    </td>
                    <td><input type="number" min="0" value="${invitado.acompanantes || 0}" onchange="actualizarInvitado('${invitado.id}', 'acompanantes', this.value)"></td>
                    <td><input type="text" value="${invitado.necesidades_especiales || ''}" onchange="actualizarInvitado('${invitado.id}', 'necesidades_especiales', this.value)"></td>
                    <td><input type="text" value="${invitado.observaciones || ''}" onchange="actualizarInvitado('${invitado.id}', 'observaciones', this.value)"></td>
                    <td class="action-buttons">
                        <button class="btn btn-danger btn-small" onclick="eliminarInvitado('${invitado.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Funciones CRUD
        async function agregarNuevoAporte() {
            try {
                const docRef = await window.firebaseFunctions.addDoc(
                    window.firebaseFunctions.collection(window.firebaseDB, 'aportes'),
                    {
                        nombre: 'Nuevo familiar',
                        monto_comprometido: 0,
                        monto_entregado: 0,
                        fecha_aporte: '',
                        forma_pago: '',
                        observaciones: '',
                        created_at: new Date()
                    }
                );
                
                aportes.push({
                    id: docRef.id,
                    nombre: 'Nuevo familiar',
                    monto_comprometido: 0,
                    monto_entregado: 0,
                    fecha_aporte: '',
                    forma_pago: '',
                    observaciones: ''
                });
                
                actualizarTablaAportes();
            } catch (error) {
                console.error('Error agregando aporte:', error);
                alert('Error al agregar familiar');
            }
        }
        
        async function actualizarAporte(id, campo, valor) {
            try {
                await window.firebaseFunctions.updateDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'aportes', id),
                    { [campo]: campo.includes('monto') ? parseFloat(valor) || 0 : valor }
                );
                
                const index = aportes.findIndex(a => a.id === id);
                if (index !== -1) {
                    aportes[index][campo] = campo.includes('monto') ? parseFloat(valor) || 0 : valor;
                    actualizarTablaAportes();
                }
            } catch (error) {
                console.error('Error actualizando aporte:', error);
            }
        }
        
        async function eliminarAporte(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este aporte?')) return;
            
            try {
                await window.firebaseFunctions.deleteDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'aportes', id)
                );
                
                aportes = aportes.filter(a => a.id !== id);
                actualizarTablaAportes();
            } catch (error) {
                console.error('Error eliminando aporte:', error);
                alert('Error al eliminar aporte');
            }
        }
        
        // Funciones similares para gastos, tareas e invitados...
        async function agregarNuevoGasto() {
            try {
                const docRef = await window.firebaseFunctions.addDoc(
                    window.firebaseFunctions.collection(window.firebaseDB, 'gastos'),
                    {
                        categoria: '',
                        proveedor: '',
                        costo_estimado: 0,
                        costo_real: 0,
                        fecha_pago: '',
                        pagado_por: '',
                        observaciones: '',
                        created_at: new Date()
                    }
                );
                
                gastos.push({
                    id: docRef.id,
                    categoria: '',
                    proveedor: '',
                    costo_estimado: 0,
                    costo_real: 0,
                    fecha_pago: '',
                    pagado_por: '',
                    observaciones: ''
                });
                
                actualizarTablaGastos();
            } catch (error) {
                console.error('Error agregando gasto:', error);
                alert('Error al agregar gasto');
            }
        }
        
        async function actualizarGasto(id, campo, valor) {
            try {
                await window.firebaseFunctions.updateDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'gastos', id),
                    { [campo]: campo.includes('costo') ? parseFloat(valor) || 0 : valor }
                );
                
                const index = gastos.findIndex(g => g.id === id);
                if (index !== -1) {
                    gastos[index][campo] = campo.includes('costo') ? parseFloat(valor) || 0 : valor;
                    actualizarTablaGastos();
                }
            } catch (error) {
                console.error('Error actualizando gasto:', error);
            }
        }
        
        async function eliminarGasto(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este gasto?')) return;
            
            try {
                await window.firebaseFunctions.deleteDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'gastos', id)
                );
                
                gastos = gastos.filter(g => g.id !== id);
                actualizarTablaGastos();
            } catch (error) {
                console.error('Error eliminando gasto:', error);
                alert('Error al eliminar gasto');
            }
        }
        
        // Funciones para tareas
        async function agregarNuevaTarea() {
            try {
                const docRef = await window.firebaseFunctions.addDoc(
                    window.firebaseFunctions.collection(window.firebaseDB, 'tareas'),
                    {
                        tarea: 'Nueva tarea',
                        categoria: '',
                        responsable: '',
                        fecha_limite: '',
                        prioridad: 'media',
                        estado: 'pendiente',
                        observaciones: '',
                        created_at: new Date()
                    }
                );
                
                tareas.push({
                    id: docRef.id,
                    tarea: 'Nueva tarea',
                    categoria: '',
                    responsable: '',
                    fecha_limite: '',
                    prioridad: 'media',
                    estado: 'pendiente',
                    observaciones: ''
                });
                
                actualizarTablaTareas();
            } catch (error) {
                console.error('Error agregando tarea:', error);
                alert('Error al agregar tarea');
            }
        }
        
        async function actualizarTarea(id, campo, valor) {
            try {
                await window.firebaseFunctions.updateDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'tareas', id),
                    { [campo]: valor }
                );
                
                const index = tareas.findIndex(t => t.id === id);
                if (index !== -1) {
                    tareas[index][campo] = valor;
                    actualizarTablaTareas();
                }
            } catch (error) {
                console.error('Error actualizando tarea:', error);
            }
        }
        
        async function eliminarTarea(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar esta tarea?')) return;
            
            try {
                await window.firebaseFunctions.deleteDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'tareas', id)
                );
                
                tareas = tareas.filter(t => t.id !== id);
                actualizarTablaTareas();
            } catch (error) {
                console.error('Error eliminando tarea:', error);
                alert('Error al eliminar tarea');
            }
        }
        
        // Funciones para invitados
        async function agregarNuevoInvitado() {
            try {
                const docRef = await window.firebaseFunctions.addDoc(
                    window.firebaseFunctions.collection(window.firebaseDB, 'invitados'),
                    {
                        nombre_completo: 'Nuevo invitado',
                        relacion: '',
                        telefono: '',
                        email: '',
                        estado: 'pendiente',
                        acompanantes: 0,
                        necesidades_especiales: '',
                        observaciones: '',
                        created_at: new Date()
                    }
                );
                
                invitados.push({
                    id: docRef.id,
                    nombre_completo: 'Nuevo invitado',
                    relacion: '',
                    telefono: '',
                    email: '',
                    estado: 'pendiente',
                    acompanantes: 0,
                    necesidades_especiales: '',
                    observaciones: ''
                });
                
                actualizarTablaInvitados();
            } catch (error) {
                console.error('Error agregando invitado:', error);
                alert('Error al agregar invitado');
            }
        }
        
        async function actualizarInvitado(id, campo, valor) {
            try {
                await window.firebaseFunctions.updateDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'invitados', id),
                    { [campo]: campo === 'acompanantes' ? parseInt(valor) || 0 : valor }
                );
                
                const index = invitados.findIndex(i => i.id === id);
                if (index !== -1) {
                    invitados[index][campo] = campo === 'acompanantes' ? parseInt(valor) || 0 : valor;
                    actualizarTablaInvitados();
                }
            } catch (error) {
                console.error('Error actualizando invitado:', error);
            }
        }
        
        async function eliminarInvitado(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este invitado?')) return;
            
            try {
                await window.firebaseFunctions.deleteDoc(
                    window.firebaseFunctions.doc(window.firebaseDB, 'invitados', id)
                );
                
                invitados = invitados.filter(i => i.id !== id);
                actualizarTablaInvitados();
            } catch (error) {
                console.error('Error eliminando invitado:', error);
                alert('Error al eliminar invitado');
            }
        }
        
        // Funci√≥n para cambiar tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'resumen') {
                actualizarResumen();
            }
        }
        
        function actualizarResumen() {
            const totalComprometido = aportes.reduce((sum, a) => sum + (a.monto_comprometido || 0), 0);
            const totalRecibido = aportes.reduce((sum, a) => sum + (a.monto_entregado || 0), 0);
            const totalGastosEstimados = gastos.reduce((sum, g) => sum + (g.costo_estimado || 0), 0);
            const totalGastosReales = gastos.reduce((sum, g) => sum + (g.costo_real || 0), 0);
            const balance = totalRecibido - totalGastosReales;
            
            document.getElementById('resumenContent').innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin: 20px 0;">
                    <h2 style="text-align: center; margin-bottom: 30px;">üìä Resumen Financiero</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; text-align: center;">
                            <h3>Aportes Comprometidos</h3>
                            <p style="font-size: 2em; font-weight: bold;">‚Ç°${totalComprometido.toFixed(2)}</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; text-align: center;">
                            <h3>Aportes Recibidos</h3>
                            <p style="font-size: 2em; font-weight: bold;">‚Ç°${totalRecibido.toFixed(2)}</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; text-align: center;">
                            <h3>Gastos Estimados</h3>
                            <p style="font-size: 2em; font-weight: bold;">‚Ç°${totalGastosEstimados.toFixed(2)}</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; text-align: center;">
                            <h3>Gastos Reales</h3>
                            <p style="font-size: 2em; font-weight: bold;">‚Ç°${totalGastosReales.toFixed(2)}</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; text-align: center; grid-column: 1 / -1;">
                            <h3>Balance Final</h3>
                            <p style="font-size: 2.5em; font-weight: bold; color: ${balance >= 0 ? '#4CAF50' : '#f44336'}">‚Ç°${balance.toFixed(2)}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Funci√≥n para exportar Excel
        function exportarExcel() {
            const wb = XLSX.utils.book_new();
            
            // Hoja 1: Aportes
            const aportesData = [['ID', 'Nombre', 'Monto Comprometido', 'Monto Entregado', 'Fecha', 'Forma de Pago', 'Observaciones', 'Saldo']];
            aportes.forEach(aporte => {
                const saldo = (aporte.monto_comprometido || 0) - (aporte.monto_entregado || 0);
                aportesData.push([
                    aporte.id,
                    aporte.nombre || '',
                    aporte.monto_comprometido || 0,
                    aporte.monto_entregado || 0,
                    aporte.fecha_aporte || '',
                    aporte.forma_pago || '',
                    aporte.observaciones || '',
                    saldo
                ]);
            });
            
            const ws1 = XLSX.utils.aoa_to_sheet(aportesData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Aportes');
            
            // Hoja 2: Gastos
            const gastosData = [['ID', 'Categor√≠a', 'Proveedor', 'Costo Estimado', 'Costo Real', 'Diferencia', 'Fecha Pago', 'Pagado Por', 'Observaciones']];
            gastos.forEach(gasto => {
                const diferencia = (gasto.costo_estimado || 0) - (gasto.costo_real || 0);
                gastosData.push([
                    gasto.id,
                    gasto.categoria || '',
                    gasto.proveedor || '',
                    gasto.costo_estimado || 0,
                    gasto.costo_real || 0,
                    diferencia,
                    gasto.fecha_pago || '',
                    gasto.pagado_por || '',
                    gasto.observaciones || ''
                ]);
            });
            
            const ws2 = XLSX.utils.aoa_to_sheet(gastosData);
            XLSX.utils.book_append_sheet(wb, ws2, 'Gastos');
            
            // Hoja 3: Tareas
            const tareasData = [['ID', 'Tarea', 'Categor√≠a', 'Responsable', 'Fecha L√≠mite', 'Prioridad', 'Estado', 'Observaciones']];
            tareas.forEach(tarea => {
                tareasData.push([
                    tarea.id,
                    tarea.tarea || '',
                    tarea.categoria || '',
                    tarea.responsable || '',
                    tarea.fecha_limite || '',
                    tarea.prioridad || '',
                    tarea.estado || '',
                    tarea.observaciones || ''
                ]);
            });
            
            const ws3 = XLSX.utils.aoa_to_sheet(tareasData);
            XLSX.utils.book_append_sheet(wb, ws3, 'Tareas');
            
            // Hoja 4: Invitados
            const invitadosData = [['ID', 'Nombre', 'Relaci√≥n', 'Tel√©fono', 'Email', 'Estado', 'Acompa√±antes', 'Necesidades Especiales', 'Observaciones']];
            invitados.forEach(invitado => {
                invitadosData.push([
                    invitado.id,
                    invitado.nombre_completo || '',
                    invitado.relacion || '',
                    invitado.telefono || '',
                    invitado.email || '',
                    invitado.estado || '',
                    invitado.acompanantes || 0,
                    invitado.necesidades_especiales || '',
                    invitado.observaciones || ''
                ]);
            });
            
            const ws4 = XLSX.utils.aoa_to_sheet(invitadosData);
            XLSX.utils.book_append_sheet(wb, ws4, 'Invitados');
            
            const fecha = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `fiesta_50_aniversario_cloud_${fecha}.xlsx`);
            alert('üìä ¬°Archivo Excel descargado exitosamente desde la nube! üéâ');
        }
    </script>
</body>
</html>
